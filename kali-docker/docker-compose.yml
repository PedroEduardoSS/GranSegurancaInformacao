version: '3.8'

services:
  kali:
    build: .
    container_name: kali_lab
    tty: true           # Permite interação com o terminal
    stdin_open: true    # Mantém o terminal aberto
    restart: always
    
    # Segurança: Limita os privilégios do container
    cap_drop:
      - ALL
    cap_add:
      - NET_RAW          # Necessário para ferramentas de rede (ex: nmap)
      - NET_ADMIN        # Necessário para manipular interfaces de rede
    
    # Limitação de Recursos (Segurança de Disponibilidade)
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 2G

    # Volumes para persistência de dados
    volumes:
      - ./data:/home/kali-user/work
    
    # Rede isolada
    networks:
      - kali_internal

networks:
  kali_internal:
    driver: bridge